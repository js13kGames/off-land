<html>
<style>
    #gameCanvas {cursor: none;}
</style>
<canvas id="gameCanvas" width="800" height="600"></canvas>

<script>

    var canvas;
    var canvasContext;

    let foodConfig = {
        width : 25,
        height : 25,
        qty: 10
    };

    let levelConfig = {
        width:  800,
        height:  600,
        life: 5,
        shield: 0,
        framesPerSecond: 60
    };

    let aiConfig = {
        move: {
            x: 5,
            y: 5
        },
        width : 15,
        height : 15,
        qty: 10
    };

    let foodImg = new Image();
    let aiImg = new Image();
    //foodImg.src = 'http://icons.iconarchive.com/icons/google/noto-emoji-food-drink/256/32382-hamburger-icon.png';
    foodImg.src = 'small-burguer.png';
    aiImg.src = 'https://www.html5canvastutorials.com/demos/assets/darth-vader.jpg';

    let food = [];
    let ai = [];
    let player ;

    function Element (x, y, h, w) {
        this.x = x;
        this.y = y;
        this.h = h;
        this.w = w;
        this.relocate = function () {
            this.xw = this.x + this.w;
            this.yh = this.y + this.h;
        };
        this.relocate();
    }

    function AIElement(x, y, h, w){
        this.e = new Element (x, y, h, w);
        this.safe = 0;
       var getRandomSign = function () {
           return Math.random() < 0.5 ? -1 : 1;
        };
        this.direction = {
            x:  aiConfig.move.x * getRandomSign(),
            y: aiConfig.move.y * getRandomSign()
        };
        this.move = function(){
            this.changeDirection();
            this.e.x += this.direction.x;
            this.e.y += this.direction.y;
        };

        this.changeDirection = function () {
            if(this.e.xw >= levelConfig.width || this.e.xw <= 0)
                this.direction.x = -this.direction.x;

            if(this.e.yh >= levelConfig.height || this.e.yh <= 0)
                this.direction.y = -this.direction.y;
        }
    }



    function generateAI() {
        let f = function (maximum) {
            return Math.floor((Math.random() * maximum) + 1);
        };

        for(let i = 0; i < aiConfig.qty; i++) {
            var randomX = f(levelConfig.width - aiConfig.width);
            var randomY = f(levelConfig.height - aiConfig.height);
            ai.push( new AIElement(randomX, randomY, aiConfig.width, aiConfig.height) );
        }
    }

    function generateFoodItems() {
        let f = function (maximum) {
            return Math.floor((Math.random() * maximum) + 1);
        };

        for(let i = 0; i < foodConfig.qty; i++) {
            var randomX = f(levelConfig.width - foodConfig.width);
            var randomY = f(levelConfig.height - foodConfig.height);
            food.push( new Element(randomX, randomY, foodConfig.width, foodConfig.height) );
        }
    }

    function init(){
        player =  new Element(0, 250, 25, 25);
        generateFoodItems();
        generateAI();
    }

    function calculateMousePos(evt) {
        var rect = canvas.getBoundingClientRect();
        var root = document.documentElement;
        var mouseX = evt.clientX - rect.left - root.scrollLeft;
        var mouseY = evt.clientY - rect.top - root.scrollTop;
        return {
            x:mouseX,
            y:mouseY
        };
    }

    window.onload = function() {
        canvas = document.getElementById('gameCanvas');
        canvasContext = canvas.getContext('2d');

        init();

        setInterval(function() {
            drawEverything();
        }, 1000/levelConfig.framesPerSecond);

        canvas.addEventListener('mousemove',
            function(evt) {
                var mousePos = calculateMousePos(evt);
                player.y = mousePos.y ;
                player.x = mousePos.x ;
                player.relocate();
            });
    };

    function drawEverything() {
        // next line blanks out the screen with black
        colorRect(0,0,canvas.width,canvas.height,'black');

        // this is player
        colorRect(player.x,player.y,player.w,player.h,'white');
        levelConfig.shield--;
        checkFoodCollision();
        //this is food
        drawFood();

        drawAI();
        showLife();
        if(levelDone())
            showLevelDone();

    }

    function drawAI(){
        for(var i = 0; i < ai.length; i++){
            var a = ai[i];
            a.move();  a.e.relocate();a.safe--;
            if(levelConfig.shield <= 0 && a.safe <= 0 && checkCollision(a.e, player)){
               a.safe = levelConfig.framesPerSecond;
                levelConfig.life--;
            }
            canvasContext.drawImage(aiImg, a.e.x, a.e.y, a.e.w, a.e.h);
        }
    }

    function drawFood(){
        for(var i = 0; i < food.length; i++){
            var f = food[i];
            canvasContext.drawImage(foodImg, f.x, f.y, f.w, f.h);
        }
    }

    function levelDone(){
        if (levelConfig.life <= 0 || food.length === 0)
            return true
    }

    function showLevelDone(){
        canvasContext.fillText("click to continue", 350, 500);
    }

    function showLife(){
        canvasContext.fillText("Life " + levelConfig.life, 25, 500);
    }

    function checkCollision(item1, item2){
        if(axisCollision(item1.x, item1.xw, item2.x, item2.xw)
            && axisCollision(item1.y, item1.yh, item2.y, item2.yh) )
            return true;
    }

    function axisCollision(item1px1, item1px2, item2px1, item2px2){
        return (item1px1 > item2px1 && item1px1 < item2px2  )
            ||  (item1px2 >item2px1  && item1px2 <  item2px2)
            ||  (item2px1 >item1px1  && item2px1<  item1px2);
    }

    function checkFoodCollision(){
        var i  = food.length;
        while (i--) {
            if (checkCollision(food[i], player)) {
                food.splice(i, 1);
            }
        }
    }

    function  collectFood(){

    }

     function colorRect(leftX,topY, width,height, drawColor) {
        canvasContext.fillStyle = drawColor;
        canvasContext.fillRect(leftX,topY, width,height);
    }

</script>

</html>